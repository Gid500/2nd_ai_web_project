<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.revia.lastdance.signin.dao.SigninMapper">

    <resultMap id="userResultMap" type="com.revia.lastdance.signup.vo.UserVO">
        <id property="userId" column="user_id"/>
        <result property="userNickname" column="user_nickname"/>
        <result property="userEmail" column="user_email"/>
        <result property="userPwd" column="user_pwd"/>
        <result property="userImgUrl" column="user_img_url"/>
        <result property="roleType" column="role_type"/>
        <result property="roleId" column="role_id"/>
        <result property="createdDate" column="created_date"/>
        <result property="createdId" column="created_id"/>
        <result property="updatedDate" column="updated_date"/>
        <result property="updatedId" column="updated_id"/>
    </resultMap>

    <select id="findByUserIdOrEmail" resultMap="userResultMap">
        SELECT
            tu.user_id,
            tu.user_nickname,
            tu.user_email,
            tu.user_pwd,
            tu.user_img_url,
            tr.role_type,
            tr.role_id,
            tu.created_date,
            tu.created_id,
            tu.updated_date,
            tu.updated_id
        FROM
            tb_user tu
        LEFT JOIN
            tb_role tr ON tu.role_id = tr.role_id
        WHERE
            LOWER(tu.user_id) = LOWER(#{identifier}) OR LOWER(tu.user_email) = LOWER(#{identifier})
    </select>

    <select id="selectAllUsers" resultMap="userResultMap">
        SELECT
            tu.user_id,
            tu.user_nickname,
            tu.user_email,
            tu.user_pwd,
            tu.user_img_url,
            tr.role_type,
            tr.role_id,
            tu.created_date,
            tu.created_id,
            tu.updated_date,
            tu.updated_id
        FROM
            tb_user tu
        LEFT JOIN
            tb_role tr ON tu.role_id = tr.role_id
        ORDER BY tu.created_date DESC
    </select>

</mapper>
